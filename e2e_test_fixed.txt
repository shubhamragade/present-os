INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
ERROR:presentos.intent:OpenAI classification failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'intent_analysis': In context=('properties', 'intents', 'items', 'properties', 'payload'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
INFO:presentos.intent:Raw intent data for 'Add a high priority task: 'Test all agents' due to...': {
  "intents": [
    {
      "intent": "create_task",
      "category": "task",
      "payload": {
        "text": "Add a high priority task: 'Test all agents' due tomorrow, linked to the MVP quest, PAEI focus on Producer",
        "category": "task"
      }
    },
    {
      "intent": "create_focus",
      "category": "focus",
      "payload": {
        "text": "Add a high priority task: 'Test all agents' due tomorrow, linked to the MVP quest, PAEI focus on Producer",
        "category": "focus"
      }
    },
    {
      "intent": "create_quest",
      "category": "quest",
      "payload": {
        "text": "Add a high priority task: 'Test all agents' due tomorrow, linked to the MVP quest, PAEI focus on Producer",
        "category": "quest"
      }
    }
  ],
  "read_domains": [
    "quest_status"
  ],
  "confidence": 0.7,
  "explanation": "Rule-based fallback: detected 3 intents, 1 read domains",
  "fallback": true
}
INFO:presentos.graph:Graph invoked: 'Add a high priority task: 'Test all agents' due to...'
INFO:presentos.parent_agent:ParentNode making REAL decisions
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
INFO:presentos.pinecone:Pinecone returned 3 matches
INFO:presentos.parent_agent:RAG Retrieved 3 memories
INFO:presentos.parent_agent:PAEI Decision: A - Systematic work required
INFO:presentos.parent_agent:RPM Result: 1.0 - proceed
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
INFO:presentos.pinecone:Upserted 1 vectors into namespace=user_patterns
INFO:presentos.rag:Stored memory mem-50da0c22055e4cf7a54038f2d8eec50e (preference)
INFO:presentos.parent_agent:Continuous learning: Memory writer check complete
INFO:presentos.graph:Executing 4 instructions
INFO:presentos.execution_router:Executing task_agent with PAEI: A
INFO:presentos.task_agent:Task created in Notion: 2f333e0d-b053-81fe-9f61-e787aecbda25
INFO:presentos.execution_router:Executing focus_agent with PAEI: A
INFO:presentos.focus_agent:Mapping create_focus to enable_focus_mode
ERROR:presentos.focus_agent:Focus agent failed: '>=' not supported between instances of 'NoneType' and 'int'
Traceback (most recent call last):
  File "C:\present-os\app\graph\nodes\focus_agent.py", line 339, in run_focus_node
    optimal_config = _get_optimal_focus_time(state)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\present-os\app\graph\nodes\focus_agent.py", line 47, in _get_optimal_focus_time
    if whoop_recovery >= 80:
       ^^^^^^^^^^^^^^^^^^^^
TypeError: '>=' not supported between instances of 'NoneType' and 'int'
INFO:presentos.execution_router:Executing quest_agent with PAEI: A
INFO:presentos.quest_agent:ConversationManager detected missing slots: ['name', 'purpose', 'result']
ERROR:presentos.execution_router:Agent quest_agent failed: 'ConversationManager' object has no attribute 'extract_quest_fields'
2026-01-25 22:25:02,238 INFO presentos.notion: Created XP entry: amount=12 paei=A week=4 id=2f333e0d-b053-81cd-81f7-c203c6257fe9
INFO:presentos.notion:Created XP entry: amount=12 paei=A week=4 id=2f333e0d-b053-81cd-81f7-c203c6257fe9
INFO:presentos.xp_agent:XP entry created: action=deep_work_block xp=12 page_id=2f333e0d-b053-81cd-81f7-c203c6257fe9
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:presentos.pinecone:PineconeClient initialized index=presentos-memory-1536 namespace=presentos-rag
INFO:presentos.graph:Graph execution completed - PDF flow executed
Traceback (most recent call last):
  File "C:\present-os\tools\test_e2e_pipeline.py", line 169, in <module>

================================================================================
PRESENTOS END-TO-END PIPELINE TEST
================================================================================

User Message: "Add a high priority task: 'Test all agents' due tomorrow, linked to the MVP quest, PAEI focus on Producer"

STEP 1: Intent Classifier
--------------------------------------------------------------------------------
[OK] Classified Intents: 3
   - Intent: create_task
     Category: task
     Payload: {
      "text": "Add a high priority task: 'Test all agents' due tomorrow, linked to the MVP quest, PAEI focus on Producer",
      "category": "task"
}
   - Intent: create_focus
     Category: focus
     Payload: {
      "text": "Add a high priority task: 'Test all agents' due tomorrow, linked to the MVP quest, PAEI focus on Producer",
      "category": "focus"
}
   - Intent: create_quest
     Category: quest
     Payload: {
      "text": "Add a high priority task: 'Test all agents' due tomorrow, linked to the MVP quest, PAEI focus on Producer",
      "category": "quest"
}
   Confidence: 0.7
   Model: gpt-4o-mini

STEP 2: Parent Agent Decision
--------------------------------------------------------------------------------
   Graph built successfully
   Initial state energy: 0.8
   Timezone: Asia/Kolkata

STEP 3: Graph Execution
--------------------------------------------------------------------------------
   Graph execution complete!

   [DECISION] Parent Decision:
      PAEI Role: A
      XP Amount: 8
      Reasoning: Systematic work required
      Coordinated Action: True
      Instructions: 4 agents activated

   [AGENTS] Activated Agents:
      - task_agent: create_task
      - focus_agent: create_focus
      - quest_agent: create_quest
      - xp_agent: award_xp

STEP 4: Child Agent Outputs
--------------------------------------------------------------------------------
   Total outputs: 3

   [OUTPUT] task_agent:
      action: task_created
      task_id: 2f333e0d-b053-81fe-9f61-e787aecbda25

   [OUTPUT] focus_agent:
      status: error
      error: '>=' not supported between instances of 'NoneType' and 'int'
      intent: create_focus

   [OUTPUT] xp_agent:
      status: success
      xp: 12
      category: deep_work
      bonus: 4
      reason: Deep Work Block (medium) 60 min [PAEI=A]
      xp_page_id: 2f333e0d-b053-81cd-81f7-c203c6257fe9
      paei: A
      action_type: deep_work_block
      raw_action: deep_work_block

STEP 5: Final Response to User
--------------------------------------------------------------------------------
    test_end_to_end_pipeline()
  File "C:\present-os\tools\test_e2e_pipeline.py", line 129, in test_end_to_end_pipeline
    print(f"   [RESPONSE] Response: \"{final_response}\"\n")
  File "C:\Users\shubh\anaconda3\Lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'charmap' codec can't encode character '\U0001f31f' in position 58: character maps to <undefined>
