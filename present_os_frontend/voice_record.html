<div style="text-align: center; padding: 10px;">
    <button id="recordBtn" style="background:#3B82F6; color:white; border:none; padding:12px 20px; border-radius:50px; font-size:18px; cursor:pointer;">
        ðŸŽ¤ Hold to Speak
    </button>
    <p id="status" style="margin-top:10px; color:#64748B;">Tap and hold to record</p>
</div>

<script>
let recognition;
let isRecording = false;

if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = true;
    recognition.lang = 'en-US';

    recognition.onresult = (event) => {
        const transcript = Array.from(event.results)
            .map(result => result[0])
            .map(result => result.transcript)
            .join('');
        document.getElementById('status').innerText = transcript || 'Listening...';
        if (event.results[0].isFinal) {
            parent.postMessage({type: 'streamlit:setComponentValue', value: transcript}, '*');
        }
    };

    recognition.onerror = () => {
        document.getElementById('status').innerText = 'Try again';
        isRecording = false;
    };

    recognition.onend = () => {
        isRecording = false;
        document.getElementById('status').innerText = 'Tap to speak';
    };
}

document.getElementById('recordBtn').addEventListener('mousedown', () => {
    if (recognition) {
        recognition.start();
        isRecording = true;
        document.getElementById('status').innerText = 'Listening...';
    }
});

document.getElementById('recordBtn').addEventListener('mouseup', () => {
    if (recognition && isRecording) {
        recognition.stop();
    }
});

document.getElementById('recordBtn').addEventListener('touchstart', (e) => {
    e.preventDefault();
    if (recognition) {
        recognition.start();
        document.getElementById('status').innerText = 'Listening...';
    }
});

document.getElementById('recordBtn').addEventListener('touchend', (e) => {
    e.preventDefault();
    if (recognition) recognition.stop();
});
</script>